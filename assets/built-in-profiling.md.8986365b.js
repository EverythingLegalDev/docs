import{_ as e,c as a,o as t,a as o,b as n,e as s}from"./app.017cb202.js";var c="/assets/miniprofiler-hello.fb6c5abe.png",l="/assets/miniprofiler-simpledb.5f0c8a66.png",i="/assets/miniprofiler-simpledb-n1.ebfff655.png",r="/assets/miniprofiler-simpledb-n1-sql.a7ebb5b4.png";const _='{"title":"Built-in Mini Profiler","description":"","frontmatter":{"slug":"built-in-profiling","title":"Built-in Mini Profiler"},"headers":[{"level":3,"title":"Using the MVC Mini Profiler","slug":"using-the-mvc-mini-profiler"},{"level":2,"title":"SQL Profiling","slug":"sql-profiling"},{"level":2,"title":"View executed SQL","slug":"view-executed-sql"}],"relativePath":"built-in-profiling.md"}',p={},u=o('<p>ServiceStack&#39;s <a href="/html5reportformat">HTML5 JSON Report Format</a> also includes the <a href="https://github.com/MiniProfiler/dotnet" target="_blank" rel="noopener noreferrer">Mvc Mini Profiler</a> - by <a href="https://twitter.com/jarrod_dixon" target="_blank" rel="noopener noreferrer">@jarrod_dixon</a> and <a href="https://twitter.com/samsaffron" target="_blank" rel="noopener noreferrer">@samsaffron</a>. It&#39;s the same profiler used to profile and help speed up sites like <a href="http://www.stackoverflow.com" target="_blank" rel="noopener noreferrer">Stack Overflow</a> and more recently the much faster <a href="http://nuget.org" target="_blank" rel="noopener noreferrer">NuGet v2.0</a> website.</p><p>The MVC Mini Profiler plugin is only available for classic <a href="http://ASP.NET" target="_blank" rel="noopener noreferrer">ASP.NET</a> Framework Web Apps, for .NET Core Apps you can use the official <a href="https://www.nuget.org/packages/MiniProfiler.AspNetCore.Mvc" target="_blank" rel="noopener noreferrer">MiniProfiler.AspNetCore.Mvc</a> NuGet package, please see this community post for details:</p><ul><li><a href="http://inayearorso.io/2018/04/18/servicestack-miniprofiler-dotnetcore-angular2/" target="_blank" rel="noopener noreferrer">Servicestack + Miniprofiler + .NET Core + Angular</a></li></ul><h3 id="using-the-mvc-mini-profiler" tabindex="-1">Using the MVC Mini Profiler <a class="header-anchor" href="#using-the-mvc-mini-profiler" aria-hidden="true">#</a></h3><p>The built-in Mini Profiler is available in ServiceStack&#39;s .NET Framework features package:</p>',5),k=n("div",{class:"nuget-copy cp flex cursor-pointer mb-3",onclick:"copy(this)"},[n("div",{class:"flex-grow bg-gray-700"},[n("div",{class:"pl-4 py-1 pb-1.5 align-middle text-lg text-white"},[n("p",null,[n("code",null,'<PackageReference Include="ServiceStack.NetFramework" Version="6.*" />'),s(" :::")]),n("p",null,[s("Just like the "),n("a",{href:"https://github.com/MiniProfiler/dotnet",target:"_blank",rel:"noopener noreferrer"},"Normal Mvc Mini Profiler"),s(" you can enable it by registering the "),n("code",null,"MiniProfilerFeature"),s(" Plugin:")]),n("div",{class:"language-csharp"},[n("pre",null,[n("code",null,[s("Plugins"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Add"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token constructor-invocation class-name"},"MiniProfilerFeature"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`  
`)])])]),n("p",null,"Then starting it in your Global.asax, here's how to enable it for local requests:"),n("div",{class:"language-csharp"},[n("pre",null,[n("code",null,[n("span",{class:"token keyword"},"protected"),s(),n("span",{class:"token return-type class-name"},[n("span",{class:"token keyword"},"void")]),s(),n("span",{class:"token function"},"Application_BeginRequest"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"object")]),s(" src"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"EventArgs"),s(" e"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("Request"),n("span",{class:"token punctuation"},"."),s("IsLocal"),n("span",{class:"token punctuation"},")"),s(`
        Profiler`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Start"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"protected"),s(),n("span",{class:"token return-type class-name"},[n("span",{class:"token keyword"},"void")]),s(),n("span",{class:"token function"},"Application_EndRequest"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"object")]),s(" src"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"EventArgs"),s(" e"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"{"),s(`
    Profiler`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Stop"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])])]),n("p",null,"Now if you also have ServiceStack Razor views you can enable the profiler by putting this into your _Layout.cshtml page:"),n("div",{class:"language-csharp"},[n("pre",null,[n("code",null,[s("@ServiceStack"),n("span",{class:"token punctuation"},"."),s("MiniProfiler"),n("span",{class:"token punctuation"},"."),s("Profiler"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"RenderIncludes"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"AsRaw"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(` 
`)])])]),n("p",null,"That's it! Now every time you view a web service or a razor page in your browser (locally) you'll see a profiler view of your service broken down in different stages:"),n("p",null,[n("img",{src:c,alt:""})]),n("p",null,[s("By default you get to see how long it took ServiceStack to de-serialize your request, run any Request / Response Filters and more importantly how long it took to "),n("strong",null,"Execute"),s(" your service.")]),n("h2",{id:"sql-profiling",tabindex:"-1"},[s("SQL Profiling "),n("a",{class:"header-anchor",href:"#sql-profiling","aria-hidden":"true"},"#")]),n("p",null,"The profiler includes special support for SQL Profiling that can easily be enabled for OrmLite and Dapper by getting it to use a Profiled Connection using a ConnectionFilter:"),n("div",{class:"language-csharp"},[n("pre",null,[n("code",null,[s("Plugins"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Add"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token constructor-invocation class-name"},"MiniProfilerFeature"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// Register before using ProfiledDbConnection"),s(`

`),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("Container"),n("span",{class:"token punctuation"},"."),n("span",{class:"token generic-method"},[n("span",{class:"token function"},"Register"),n("span",{class:"token generic class-name"},[n("span",{class:"token punctuation"},"<"),s("IDbConnectionFactory"),n("span",{class:"token punctuation"},">")])]),n("span",{class:"token punctuation"},"("),s("c "),n("span",{class:"token operator"},"=>"),s(`
    `),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token constructor-invocation class-name"},"OrmLiteConnectionFactory"),n("span",{class:"token punctuation"},"("),s(`
        `),n("span",{class:"token string"},'"~/App_Data/db.sqlite"'),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"MapHostAbsolutePath"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(" SqliteDialect"),n("span",{class:"token punctuation"},"."),s("Provider"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
            ConnectionFilter `),n("span",{class:"token operator"},"="),s(" x "),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token constructor-invocation class-name"},"ProfiledDbConnection"),n("span",{class:"token punctuation"},"("),s("x"),n("span",{class:"token punctuation"},","),s(" Profiler"),n("span",{class:"token punctuation"},"."),s("Current"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])])]),n("p",null,[s("Refer to the "),n("a",{href:"https://github.com/MiniProfiler/dotnet",target:"_blank",rel:"noopener noreferrer"},"Main MVC MiniProfiler home page"),s(" for instructions on how to configure profiling for Linq2Sql and EntityFramework.")]),n("p",null,[s("It's also trivial to add custom steps enabling even finer-grained profiling for your services. Here's a "),n("a",{href:"https://github.com/ServiceStack/ServiceStack/blob/master/tests/ServiceStack.WebHost.IntegrationTests/Services/ProfilerService.cs",target:"_blank",rel:"noopener noreferrer"},"simple web service DB example"),s(" returning a list of Movies using both a simple DB query and a dreaded N+1 query.")]),n("div",{class:"language-csharp"},[n("pre",null,[n("code",null,[n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"MiniProfiler"),s(`
`),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token return-type class-name"},[n("span",{class:"token keyword"},"string")]),s(" Type "),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token keyword"},"get"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token keyword"},"set"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"MiniProfilerService"),s(),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token type-list"},[n("span",{class:"token class-name"},"Service")]),s(`
`),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token return-type class-name"},[n("span",{class:"token keyword"},"object")]),s(),n("span",{class:"token function"},"Any"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"MiniProfiler"),s(" request"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" profiler "),n("span",{class:"token operator"},"="),s(" Profiler"),n("span",{class:"token punctuation"},"."),s("Current"),n("span",{class:"token punctuation"},";"),s(`

        `),n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token punctuation"},"("),s("profiler"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Step"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"MiniProfiler Service"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("request"),n("span",{class:"token punctuation"},"."),s("Type "),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token string"},'"n1"'),n("span",{class:"token punctuation"},")"),s(`
            `),n("span",{class:"token punctuation"},"{"),s(`
                `),n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token punctuation"},"("),s("profiler"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Step"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"N + 1 query"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
                `),n("span",{class:"token punctuation"},"{"),s(`
                    `),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" results "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token constructor-invocation class-name"},[s("List"),n("span",{class:"token punctuation"},"<"),s("Movie"),n("span",{class:"token punctuation"},">")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
                    `),n("span",{class:"token keyword"},"foreach"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" movie "),n("span",{class:"token keyword"},"in"),s(" Db"),n("span",{class:"token punctuation"},"."),n("span",{class:"token generic-method"},[n("span",{class:"token function"},"Select"),n("span",{class:"token generic class-name"},[n("span",{class:"token punctuation"},"<"),s("Movie"),n("span",{class:"token punctuation"},">")])]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
                    `),n("span",{class:"token punctuation"},"{"),s(`
                        results`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Add"),n("span",{class:"token punctuation"},"("),s("Db"),n("span",{class:"token punctuation"},"."),n("span",{class:"token generic-method"},[n("span",{class:"token function"},"QueryById"),n("span",{class:"token generic class-name"},[n("span",{class:"token punctuation"},"<"),s("Movie"),n("span",{class:"token punctuation"},">")])]),n("span",{class:"token punctuation"},"("),s("movie"),n("span",{class:"token punctuation"},"."),s("Id"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
                    `),n("span",{class:"token punctuation"},"}"),s(`
                    `),n("span",{class:"token keyword"},"return"),s(" results"),n("span",{class:"token punctuation"},";"),s(`
                `),n("span",{class:"token punctuation"},"}"),s(`
            `),n("span",{class:"token punctuation"},"}"),s(`

            `),n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token punctuation"},"("),s("profiler"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Step"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Simple Select all"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
            `),n("span",{class:"token punctuation"},"{"),s(`
                `),n("span",{class:"token keyword"},"return"),s(" Db"),n("span",{class:"token punctuation"},"."),n("span",{class:"token generic-method"},[n("span",{class:"token function"},"Select"),n("span",{class:"token generic class-name"},[n("span",{class:"token punctuation"},"<"),s("Movie"),n("span",{class:"token punctuation"},">")])]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token punctuation"},"}"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])])]),n("h2",{id:"view-executed-sql",tabindex:"-1"},[s("View executed SQL "),n("a",{class:"header-anchor",href:"#view-executed-sql","aria-hidden":"true"},"#")]),n("p",null,"Calling the above service normally provides the following Profiler output:"),n("p",null,[n("img",{src:l,alt:""})]),n("p",null,[s("Whilst calling the service with the "),n("strong",null,"n1"),s(" param yields the following warning:")]),n("p",null,[n("img",{src:i,alt:""})]),n("p",null,[s("In both cases you see the actual SQL statements performed by clicking the "),n("strong",null,"SQL"),s(" link. The N+1 query provides shows the following:")]),n("p",null,[n("img",{src:r,alt:""})]),n("p",null,[s("Notice the special attention the MVC MiniProfiler team put into identifying "),n("strong",null,"Duplicate"),s(" queries - Thanks Guys!")]),n("h1",{id:"community-resources",tabindex:"-1"},[s("Community Resources "),n("a",{class:"header-anchor",href:"#community-resources","aria-hidden":"true"},"#")]),n("ul",null,[n("li",null,[n("a",{href:"http://tunurgitr.blogspot.com/2012/04/miniprofiler-for-ajax-calls-with.html",target:"_blank",rel:"noopener noreferrer"},"MiniProfiler for AJAX calls with ServiceStack.Net"),s(" by Jeff Harris")])])])]),n("div",{class:"flex"},[n("div",{class:"bg-sky-500 text-white p-1.5 pb-0"},[n("svg",{class:"copied w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})]),n("svg",{class:"nocopy w-6 h-6",title:"copy",fill:"none",stroke:"white",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})])])])],-1),f=[u,k];function d(g,h,m,w,v,y){return t(),a("div",null,f)}var S=e(p,[["render",d]]);export{_ as __pageData,S as default};
